<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Vagrant Clusters &mdash; zendev 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="zendev 0.1.0 documentation" href="index.html" />
    <link rel="next" title="Building the Development Base Box" href="packer.html" />
    <link rel="prev" title="Working With Vagrant Boxes" href="vagrant.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">zendev</a>
      <span class="navbar-text pull-left"><b>0.1.0</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown">
  <a href="index.html" class="dropdown-toggle" data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">zendev</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Working With Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="repos.html">Working With Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building Zenoss With zendev</a></li>
<li class="toctree-l1"><a class="reference internal" href="devimg.html">Developing Zenoss in the Control Plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="vagrant.html">Working With Vagrant Boxes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Vagrant Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="packer.html">Building the Development Base Box</a></li>
<li class="toctree-l1"><a class="reference internal" href="improve.html">Improving zendev</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Vagrant Clusters</a><ul>
<li><a class="reference internal" href="#creating-a-vagrant-cluster">Creating a Vagrant Cluster</a></li>
<li><a class="reference internal" href="#listing-clusters">Listing Clusters</a></li>
<li><a class="reference internal" href="#start-a-cluster">Start a cluster</a></li>
<li><a class="reference internal" href="#halt-a-cluster">Halt a cluster</a></li>
<li><a class="reference internal" href="#login-to-a-box-in-a-cluster">Login to a box in a cluster</a></li>
<li><a class="reference internal" href="#destroy-a-cluster">Destroy a cluster</a></li>
<li><a class="reference internal" href="#example-creating-and-running-a-multi-host-network">Example: Creating and running a multi-host network</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="vagrant.html"
         title="previous chapter">&laquo; Working With Vagrant Boxes</a></li>
  <li><a href="packer.html"
         title="next chapter">Building the Development Base Box &raquo;</a></li>
          
          
            <li>
  <a href="_sources/cluster.txt"
     rel="nofollow">Source</a></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="vagrant-clusters">
<h1>Vagrant Clusters<a class="headerlink" href="#vagrant-clusters" title="Permalink to this headline">¶</a></h1>
<p>The zendev cluster command allows you to provision clusters of Vagrant boxes
with your source tree mounted, zendev installed, and the zendev environment set
up on each of them.  The cluster is configured to make multihost serviced
development easy.</p>
<div class="section" id="creating-a-vagrant-cluster">
<h2>Creating a Vagrant Cluster<a class="headerlink" href="#creating-a-vagrant-cluster" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">create</span></tt> will create a Vagrant cluster on a private network for
multi-host testing.  The nodes will be set up to run as agents, with the master running
on the host development machine.</p>
<p>The cluster must be given a name that will be used to manage the whole cluster.
The individual box names are derived from the cluster name by appending a two
digit number to the cluster name. The number of boxes
in a cluster is specified by the <tt class="docutils literal"><span class="pre">count</span></tt> option. The amount of memory allocated
to each box is specified by the <tt class="docutils literal"><span class="pre">memory</span></tt> option.  The number of cpus allocated to
each box is specified by the <tt class="docutils literal"><span class="pre">cpus</span></tt> option.</p>
<p>Acceptable box types are: <tt class="docutils literal"><span class="pre">ubuntu</span></tt>, <tt class="docutils literal"><span class="pre">fedora</span></tt>, <tt class="docutils literal"><span class="pre">controlplane</span></tt>, and <tt class="docutils literal"><span class="pre">sourcebuild</span></tt>.
The default is <tt class="docutils literal"><span class="pre">ubuntu</span></tt>.</p>
<p>It is also possible to create one or more btrfs volumes on each vm.  The number of
btrfs volumes is specified with the by the <tt class="docutils literal"><span class="pre">btrfs</span></tt> option.  The size of the btrfs
volumes is controlled by the <tt class="docutils literal"><span class="pre">fssize</span></tt> option.  The first two volumes are mounted
at /var/lib/docker and /opt/serviced/var respectively.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Create a new cluster named demo containing 5 ubuntu boxes</span>
zendev cluster create --type ubuntu --count <span class="m">5</span> demo

<span class="c"># Create a new cluster of 3 ubuntu boxes named 4p with 2MB of RAM each</span>
zendev cluster create --type ubuntu --count <span class="m">3</span> --memory <span class="m">2048</span> 4p
</pre></div>
</div>
</div>
<div class="section" id="listing-clusters">
<h2>Listing Clusters<a class="headerlink" href="#listing-clusters" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">ls</span></tt> displays a list of available clusters.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># List all the clusters</span>
zendev cluster ls
</pre></div>
</div>
<p>To list the boxes within a cluster, specify the cluster name: <tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">ls</span> <span class="pre">CLUSTER</span></tt></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># List boxes in the cluster named CLUSTER</span>
zendev cluster ls CLUSTER
</pre></div>
</div>
</div>
<div class="section" id="start-a-cluster">
<h2>Start a cluster<a class="headerlink" href="#start-a-cluster" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">up</span></tt> will start all the boxes in a given cluster.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Start all the boxes in the cluster named CLUSTER</span>
zendev cluster up CLUSTER
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">up</span></tt> can be used to start a single box in a given cluster.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Start the box named BOX in the cluster CLUSTER</span>
zendev cluster up CLUSTER BOX
</pre></div>
</div>
</div>
<div class="section" id="halt-a-cluster">
<h2>Halt a cluster<a class="headerlink" href="#halt-a-cluster" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">halt</span></tt> will stop all the boxes in a given cluster.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Stop all the boxes in the cluster named CLUSTER</span>
zendev cluster halt CLUSTER
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">halt</span></tt> can also be used to halt a specified box in a given cluster.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Stop the box named BOX in cluster CLUSTER</span>
zendev cluster halt CLUSTER BOX
</pre></div>
</div>
</div>
<div class="section" id="login-to-a-box-in-a-cluster">
<h2>Login to a box in a cluster<a class="headerlink" href="#login-to-a-box-in-a-cluster" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">ssh</span></tt> allows you to login to a specific box in a given cluster.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Login to the box named BOX in cluster CLUSTER</span>
zendev cluster ssh CLUSTER BOX
</pre></div>
</div>
</div>
<div class="section" id="destroy-a-cluster">
<h2>Destroy a cluster<a class="headerlink" href="#destroy-a-cluster" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">zendev</span> <span class="pre">cluster</span> <span class="pre">destroy</span></tt> rids the world of the specified cluster</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Destroy the cluster named CLUSTER</span>
zendev cluster destroy CLUSTER
</pre></div>
</div>
</div>
<div class="section" id="example-creating-and-running-a-multi-host-network">
<h2>Example: Creating and running a multi-host network<a class="headerlink" href="#example-creating-and-running-a-multi-host-network" title="Permalink to this headline">¶</a></h2>
<p>All nodes in the network are set up to run as agents of a master running on the host.
All nodes share the <tt class="docutils literal"><span class="pre">devimg</span></tt> mounts, so that they all run the same code.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Create a cluster with one node</span>
zendev cluster create foo

<span class="c"># Start CC master on the host</span>
<span class="c"># &quot;--cluster-master&quot; instructs zendev to run with SERVICED_REGISTRY and</span>
<span class="c">#   SERVICED_OUTBOUND_IP set appropriately</span>
zendev serviced -dx --cluster-master

<span class="c"># Start CC agent on the VM</span>
<span class="c"># &#39;--skip-ready-wait&#39; tells zendev not to poll CC for ready status</span>
zendev cluster ssh foo
zendev serviced --skip_ready_wait
</pre></div>
</div>
<p><em>Note</em>:
Currently serviced does not allow non-serviced controlled nfs exports.  Unfortunately,
zendev needs to nfs mount the zenhome directory into the VM. (vboxsf mounts do not work as they
do not support chown.)  serviced overwrites the /etc/hosts.allow file when it starts up; virtualbox
amends that file when it boots the VM.  Therefore, it is necessary to boot/reboot the VMs each time
you restart serviced.</p>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014 Zenoss.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>